<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18: http://docutils.sourceforge.net/" />

  <meta property="og:title" content="Tuning a Flywheel Velocity Controller" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
  <meta property="og:site_name" content="FIRST Robotics Competition Documentation" />
  <meta property="og:description" content="In this section, we will tune a simple velocity controller for a flywheel. The tuning principles explained here will also work for almost any velocity control scenario. Flywheel Model Description: ..." />
  <meta property="og:image" content="https://raw.githubusercontent.com/wpilibsuite/branding/main/png/wpilib-128.png" />
  <meta property="og:image:alt" content="FIRST Robotics Competition Documentation" />
  <meta property="og:ignore_canonical" content="true" />
<meta name="theme-color" content="#003974" />
<meta name="google-site-verification" content="xcmdxM0KzMYiAOeJzyF_l2Tn3AHGzPICs9_vX6q2nwM" />
<link rel="alternate" hreflang="en" href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="x-default" href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="es" href="https://docs.wpilib.org/es/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="fr" href="https://docs.wpilib.org/fr/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="he" href="https://docs.wpilib.org/he/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="pt" href="https://docs.wpilib.org/pt/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="tr" href="https://docs.wpilib.org/tr/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
<link rel="alternate" hreflang="zh-CN" href="https://docs.wpilib.org/zh_CN/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tuning a Flywheel Velocity Controller &mdash; FIRST Robotics Competition  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster.custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster.bundle.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster-sideTip-shadow.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster-sideTip-punk.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster-sideTip-noir.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster-sideTip-light.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/tooltipster-sideTip-borderless.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/micromodal.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/pid-tune.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/frc-rtd.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/sphinx_rtd_theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/FIRSTicon_RGB_withTM.ico"/>
    <link rel="canonical" href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/tuning-flywheel.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script async="async" src="../../../../_static/js/present.js"></script>
        <script src="../../../../_static/js/hoverxref.js"></script>
        <script src="../../../../_static/js/tooltipster.bundle.min.js"></script>
        <script src="../../../../_static/js/micromodal.min.js"></script>
        <script src="../../../../_static/js/versionwarning.js"></script>
        <script src="../../../../_static/pid-tune.js"></script>
        <script src="../../../../_static/js/api-docs-redirect.js"></script>
        <script src="../../../../_static/js/fix-rtd-menu-ios.js"></script>
        <script src="../../../../_static/js/external-links-new-tab.js"></script>
        <script src="../../../../_static/js/version-2014.js"></script>
        <script src="../../../../_static/tabs.js"></script>
        <script src="../../../../_static/design-tabs.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Tuning a Turret Position Controller" href="tuning-turret.html" />
    <link rel="prev" title="Introduction To Controls Tuning Tutorials" href="tutorial-intro.html" /> 
</head>

<body class="wy-body-for-nav"> 


<div class="header-bar">
        <!-- Color Strip -->
        <div class="color-strip">
            <div class="fred"></div>
            <div class="forange"></div>
            <div class="fblue"></div>
        </div>
        <div class="link-bar-container">
            <div id="link-bar" class="collapse">
                <ul>          
                  <li id="manual-link"><a href="https://www.firstinspires.org/resource-library/frc/competition-manual-qa-system">FRC Game Manual</a></li>
                  <li id="qa-link"><a href="https://frc-qa.firstinspires.org/">FRC Game Q&A</a></li>
                  <script id="headerscript">
                    if( new Date().getMonth() == 3 && new Date().getDate() == 1) {
                      document.getElementById("headerscript").insertAdjacentHTML("afterend", '<li id="water-link"><a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">Water Game</a></li>');
                    }
                  </script>
                </ul>
            </div>
        </div>
</div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <a href="../../../../index.html" style="display: block; margin-bottom: 0;">
      FIRST Robotics Competition
    <picture>
      <source
        sizes="300px"
        srcset="../../../../_static/wpilibDocsLogo_300.webp 300w, ../../../../_static/wpilibDocsLogo_500.webp 500w, ../../../../_static/wpilibDocsLogo_700.webp 700w, ../../../../_static/wpilibDocsLogo_1050.webp 1050w"
        type="image/webp"
      />
      <img
        src="../../../../_static/wpilibDocsLogo.png"
        sizes="300px"
        srcset="../../../../_static/wpilibDocsLogo_300.png 300w, ../../../../_static/wpilibDocsLogo_500.png 500w, ../../../../_static/wpilibDocsLogo_700.png 700w, ../../../../_static/wpilibDocsLogo_1050.png 1050w"
        height="468"
        width="1050"
        alt="Logo"
        decoding="async"
        class="logo"
        style="height: auto; width: 100%; border-radius: 0%;"
      />
    </picture>
  </a>
      <div class="version">
        latest
      </div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Zero to Robot</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../zero-to-robot/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zero-to-robot/step-1/index.html">Step 1: Building your Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zero-to-robot/step-2/index.html">Step 2: Installing Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zero-to-robot/step-3/index.html">Step 3: Preparing Your Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zero-to-robot/step-4/index.html">Step 4: Programming your Robot</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Control System Overviews</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../controls-overviews/control-system-hardware.html">Hardware Component Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../controls-overviews/control-system-software.html">Software Component Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programming Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../what-is-wpilib.html">What is WPILib?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../yearly-overview/index.html">2023 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vscode-overview/index.html">VS Code Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dashboards/index.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../telemetry/index.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../labview/index.html">FRC LabVIEW Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware-apis/index.html">Hardware APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../can-devices/index.html">CAN Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic-programming/index.html">Basic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/support-resources.html">Support Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frc-glossary.html">FRC Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.wpilib.org/allwpilib/docs/release/java/index.html">WPILib Java API Docs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.wpilib.org/allwpilib/docs/release/cpp/index.html">WPILib C++ API Docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driverstation/index.html">Driver Station</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wpilib-tools/robotbuilder/index.html">RobotBuilder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wpilib-tools/robot-simulation/index.html">Robot Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wpilib-tools/outlineviewer/index.html">OutlineViewer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Programming</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../vision-processing/index.html">Vision Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../commandbased/index.html">Command-Based Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kinematics-and-odometry/index.html">Kinematics and Odometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networktables/index.html">NetworkTables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pathplanning/index.html">Path Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roborio-info/index.html">roboRIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced-gradlerio/index.html">Advanced GradleRIO</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Advanced Controls</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../video-walkthrough.html">A Video Walkthrough of Model Based Validation of Autonomous in FRC</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Advanced Controls Introduction</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="control-system-basics.html">Control System Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="picking-control-strategy.html">Picking a Control Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="introduction-to-feedforward.html">Introduction to DC Motor Feedforward</a></li>
<li class="toctree-l3"><a class="reference internal" href="introduction-to-pid.html">Introduction to PID</a></li>
<li class="toctree-l3"><a class="reference internal" href="pid-video.html">PID Introduction Video by WPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial-intro.html">Introduction To Controls Tuning Tutorials</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Tuning a Flywheel Velocity Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuning-turret.html">Tuning a Turret Position Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuning-vertical-arm.html">Tuning a Vertical Arm Position Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="common-control-issues.html">Common Control Loop Tuning Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../filters/index.html">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/index.html">Geometry Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/index.html">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trajectories/index.html">Trajectory Generation and Following with WPILib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state-space/index.html">State-Space and Model Based Control with WPILib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controls-glossary.html">Controls Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../convenience-features/index.html">Convenience Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples and Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples-tutorials/wpilib-examples.html">WPILib Example Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples-tutorials/third-party-examples.html">Third Party Example Projects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/hardware-basics/index.html">Hardware - Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/hardware-tutorials/index.html">Hardware Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hardware/sensors/index.html">Sensors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Romi Robot</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../romi-robot/index.html">Getting Started with Romi</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Robot Networking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/networking-introduction/index.html">Networking Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/networking-utilities/index.html">Networking Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/frc-docs/index.html">Contributing to frc-docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/wpilib/index.html">Developing with allwpilib</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Issues</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/wpilibsuite/frc-docs/issues">Report an Issue</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">FIRST Robotics Competition</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Advanced Controls</a></li>
          <li class="breadcrumb-item"><a href="index.html">Advanced Controls Introduction</a></li>
      <li class="breadcrumb-item active">Tuning a Flywheel Velocity Controller</li>
<li class="wy-breadcrumbs-aside" style="padding-inline-start: 6px;">
    <a href="?present" class="btn" style="background-color: #2980b9; color: white; padding: 5px">
        Present
        <span class="fa fa-expand"></span>
    </a>
</li>

      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/wpilibsuite/frc-docs/blob/main/source/docs/software/advanced-controls/introduction/tuning-flywheel.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tuning-a-flywheel-velocity-controller">
<h1>Tuning a Flywheel Velocity Controller<a class="headerlink" href="#tuning-a-flywheel-velocity-controller" title="Permalink to this heading"></a></h1>
<p>In this section, we will tune a simple velocity controller for a flywheel.  The tuning principles explained here will also work for almost any velocity control scenario.</p>
<section id="flywheel-model-description">
<h2>Flywheel Model Description<a class="headerlink" href="#flywheel-model-description" title="Permalink to this heading"></a></h2>
<p>Our “Flywheel” consists of:</p>
<blockquote>
<div><ul class="simple">
<li><p>A rotating inertial mass which launches the game piece (the flywheel)</p></li>
<li><p>A motor (and possibly a gearbox) driving the mass.</p></li>
</ul>
</div></blockquote>
<p>For the purposes of this tutorial, this plant is modeled with the same equation used by WPILib’s <a class="reference internal" href="../controllers/feedforward.html#simplemotorfeedforward"><span class="std std-ref">SimpleMotorFeedforward</span></a>, with additional adjustment for sensor delay and gearbox inefficiency. The simulation assumes the plant is controlled by feedforward and feedback controllers, composed in this fashion:</p>
<img alt="Tuning Exercise Block Diagrams showing feedforward and feedback blocks, controlling a plant." src="../../../../_images/control-system-basics-ctrl-plus-plant.png" />
<p>Where:</p>
<ul class="simple">
<li><p>The plant’s <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-output"><span class="xref std std-term">output</span></a> <span class="math notranslate nohighlight">\(y(t)\)</span> is the flywheel rotational velocity</p></li>
<li><p>The controller’s <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-setpoint"><span class="xref std std-term">setpoint</span></a> <span class="math notranslate nohighlight">\(r(t)\)</span> is the desired velocity of the flywheel</p></li>
<li><p>The controller’s <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-control-effort"><span class="xref std std-term">control effort</span></a>, <span class="math notranslate nohighlight">\(u(t)\)</span> is the voltage applied to the motor driving the flywheel’s motion</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A more detailed description of the mathematics of the system <a class="reference internal" href="../state-space/state-space-flywheel-walkthrough.html#modeling-our-flywheel"><span class="std std-ref">can be found here</span></a>.</p>
</div>
</section>
<section id="picking-the-control-strategy-for-a-flywheel-velocity-controller">
<h2>Picking the Control Strategy for a Flywheel Velocity Controller<a class="headerlink" href="#picking-the-control-strategy-for-a-flywheel-velocity-controller" title="Permalink to this heading"></a></h2>
<p>In general: the more voltage that is applied to the motor, the faster the flywheel will spin. Once voltage is removed, friction and <a class="hxr-hoverxref hxr-tooltip reference internal" href="../../frc-glossary.html#term-back-EMF"><span class="xref std std-term">back-EMF</span></a> oppose the motion and bring the flywheel to a stop.</p>
<p>Flywheels are commonly used to propel game pieces through the air, toward a target. In this simulation, a gamepiece is injected into the flywheel about halfway through the simulation. <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<p>To consistently launch a gamepiece, a good first step is to make sure it is spinning at a particular speed before putting a gamepiece into it.  Thus, we want to accurately control the velocity of our flywheel.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is fundamentally different from the <a class="reference internal" href="tuning-vertical-arm.html#tuning-a-vertical-arm-position-controller"><span class="std std-ref">vertical arm</span></a> and <a class="reference internal" href="tuning-turret.html#tuning-a-turret-position-controller"><span class="std std-ref">turret</span></a> controllers, which both control <em>position</em>.</p>
</div>
<p>The tutorials below will demonstrate the behavior of the system under bang-bang, pure feedforward, pure feedback (PID), and combined feedforward-feedback control strategies.  Follow the instructions to learn how to manually tune these controllers, and expand the “tuning solution” to view an optimal model-based set of tuning parameters.</p>
<section id="bang-bang-control">
<h3>Bang-Bang Control<a class="headerlink" href="#bang-bang-control" title="Permalink to this heading"></a></h3>
<p>Interact with the simulation below to see how the flywheel system responds when controlled by a bang-bang controller.</p>
<div class="viz-div" id="flywheel_bb_container">
  <div >
     <div class="col" id="flywheel_bb_plotVals"></div>
     <div class="col" id="flywheel_bb_plotVolts"></div>
  </div>
  <div class="flex-grid">
     <div class="col" id="flywheel_bb_viz"></div>
     <div id="flywheel_bb_ctrls"></div>
  </div>
  <script>
     flywheel_bb = new FlywheelBangBang("flywheel_bb");
  </script>
</div><p>The “Bang-Bang” controller is a simple controller which applies a binary (present/not-present) force to a mechanism to try to get it closer to a setpoint.  A more detailed description (and documentation for the corresponding WPILib implementation) can be found <a class="reference internal" href="../controllers/bang-bang.html#bang-bang-control-with-bangbangcontroller"><span class="std std-ref">here.</span></a></p>
<p>There are no tuneable controller parameters for a bang-bang controller - you can only adjust the setpoint. This simplicty is a strength, and also a weakness.</p>
<p>Try adjusting the setpoint up and down. You should see that for almost all values, the output converges to be somewhat near the setpoint.</p>
<section id="common-issues-with-bang-bang-controllers">
<h4>Common Issues with Bang-Bang Controllers<a class="headerlink" href="#common-issues-with-bang-bang-controllers" title="Permalink to this heading"></a></h4>
<p>Note that the system behavior is not perfect, because of delays in the control loop.  These can result from the nature of the sensors, measurement filters, loop iteration timers, or even delays in the control hardware itself.  Collectively, these cause a cycle of “overshoot” and “undershoot”, as the output repeatedly goes above and below the setpoint.  This oscillation is unavoidable with a bang-bang controller.</p>
<p>Typically, the steady-state oscillation of a bang-bang controller is small enough that it performs quite well in practice. However, rapid on/off cycling of the control effort can cause mechanical issues - the cycles of rapidly applying and removing forces can loosen bolts and joints, and put a lot of stress on gearboxes.</p>
<p>The abrupt changes in control effort can cause abrupt changes in current draw if the system’s inductance is too low. This may stress motor control hardware, and cause eventual damage or failure.</p>
<p>Finally, this technique only works for mechanisms that accelerate relatively slowly. A more in-depth discussion of the details <a class="reference internal" href="../controllers/bang-bang.html#bang-bang-control-with-bangbangcontroller"><span class="std std-ref">can be found here</span></a>.</p>
<p>Bang-bang control sacrifices a lot for simplicity and high performance (in the sense of fast convergence to the setpoint).  To achieve “smoother” control, we need to consider a different control strategy.</p>
</section>
</section>
<section id="pure-feedforward-control">
<h3>Pure Feedforward Control<a class="headerlink" href="#pure-feedforward-control" title="Permalink to this heading"></a></h3>
<p>Interact with the simulation below to see how the flywheel system responds when controlled only by a feedforward controller.</p>
<div class="viz-div" id="flywheel_feedforward_container">
  <div id="flywheel_feedforward">
     <div class="col" id="flywheel_feedforward_plotVals"></div>
     <div class="col" id="flywheel_feedforward_plotVolts"></div>
  </div>
  <div class="flex-grid">
     <div class="col" id="flywheel_feedforward_viz"></div>
     <div id="flywheel_feedforward_ctrls"></div>
  </div>
  <script>
     flywheel_pid = new FlywheelPIDF("flywheel_feedforward", "feedforward");
  </script>
</div><p>To tune the feedforward controller, increase the velocity feedforward gain <span class="math notranslate nohighlight">\(K_v\)</span> until the flywheel approaches the correct setpoint over time.  If the flywheel overshoots, reduce <span class="math notranslate nohighlight">\(K_v\)</span>.</p>
<details class="summary-tuning-solution">
<summary>Tuning solution</summary><p>The exact gain used by the simulation is <span class="math notranslate nohighlight">\(K_v = 0.0075\)</span>.</p>
</details><p>We can see that a pure feedforward control strategy works reasonably well for flywheel velocity control.  As we mentioned earlier, this is why it’s possible to control most motors “directly” with joysticks, without any explicit “control loop” at all.  However, we can still do better - the pure feedforward strategy cannot reject disturbances, and so takes a while to recover after the ball is introduced.  Additionally, the motor may not perfectly obey the feedforward equation (even after accounting for vibration/noise).  To account for these, we need a feedback controller.</p>
</section>
<section id="pure-feedback-control">
<h3>Pure Feedback Control<a class="headerlink" href="#pure-feedback-control" title="Permalink to this heading"></a></h3>
<p>Interact with the simulation below to see how the flywheel system responds when controlled by only a feedback (PID) controller.</p>
<div class="viz-div" id="flywheel_feedback_container">
  <div id="flywheel_feedback">
     <div class="col" id="flywheel_feedback_plotVals"></div>
     <div class="col" id="flywheel_feedback_plotVolts"></div>
  </div>
  <div class="flex-grid">
     <div class="col" id="flywheel_feedback_viz"></div>
     <div id="flywheel_feedback_ctrls"></div>
  </div>
  <script>
     flywheel_pid = new FlywheelPIDF("flywheel_feedback", "feedback");
  </script>
</div><p>Perform the following:</p>
<ol class="arabic simple">
<li><p>Set <span class="math notranslate nohighlight">\(K_p\)</span>, <span class="math notranslate nohighlight">\(K_i\)</span>, <span class="math notranslate nohighlight">\(K_d\)</span>, and <span class="math notranslate nohighlight">\(K_v\)</span> to zero.</p></li>
<li><p>Increase <span class="math notranslate nohighlight">\(K_p\)</span> until the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-output"><span class="xref std std-term">output</span></a> starts to oscillate around the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-setpoint"><span class="xref std std-term">setpoint</span></a>, then decrease it until the oscillations stop.</p></li>
<li><p><em>In some cases</em>, increase <span class="math notranslate nohighlight">\(K_i\)</span> if <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-output"><span class="xref std std-term">output</span></a> gets “stuck” before converging to the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-setpoint"><span class="xref std std-term">setpoint</span></a>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PID-only control is not a very good control scheme for flywheel velocity!  Do not be surprised if/when the simulation below does not behave well, even when the “optimal” constants are used.</p>
</div>
<details class="summary-tuning-solution">
<summary>Tuning solution</summary><p>In this particular example, for a setpoint of 300, values of <span class="math notranslate nohighlight">\(K_p = 0.1\)</span>, <span class="math notranslate nohighlight">\(K_i = 0.0\)</span>, and <span class="math notranslate nohighlight">\(K_d = 0.0\)</span> will produce somewhat reasonable results.  Since this control strategy is not very good, it will not work well for all setpoints.  You can attempt to improve this behavior by incorporating some <span class="math notranslate nohighlight">\(K_i\)</span>, but it is very difficult to achieve good behavior across a wide range of setpoints.</p>
</details><section id="issues-with-feedback-control-alone">
<h4>Issues with Feedback Control Alone<a class="headerlink" href="#issues-with-feedback-control-alone" title="Permalink to this heading"></a></h4>
<p>Because a non-zero amount of <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-control-effort"><span class="xref std std-term">control effort</span></a> is required to keep the flywheel spinning, even when the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-output"><span class="xref std std-term">output</span></a> and <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-setpoint"><span class="xref std std-term">setpoint</span></a> are equal, this feedback-only strategy is flawed.  In order to optimally control a flywheel, a combined feedforward-feedback strategy is needed.</p>
</section>
</section>
<section id="combined-feedforward-and-feedback-control">
<h3>Combined Feedforward and Feedback Control<a class="headerlink" href="#combined-feedforward-and-feedback-control" title="Permalink to this heading"></a></h3>
<p>Interact with the simulation below to see how the flywheel system responds under simultaneous feedforward and feedback (PID) control.</p>
<div class="viz-div"  id="flywheel_feedforward_feedback_container">
  <div id="flywheel_feedforward_feedback">
     <div class="col" id="flywheel_feedforward_feedback_plotVals"></div>
     <div class="col" id="flywheel_feedforward_feedback_plotVolts"></div>
  </div>
  <div class="flex-grid">
     <div class="col" id="flywheel_feedforward_feedback_viz"></div>
     <div id="flywheel_feedforward_feedback_ctrls"></div>
  </div>
  <script>
     flywheel_pid = new FlywheelPIDF("flywheel_feedforward_feedback", "both");
  </script>
</div><p>Tuning the combined flywheel controller is simple - we first tune the feedforward controller following the same procedure as in the feedforward-only section, and then we tune the PID controller following the same procedure as in the feedback-only section.  Notice that PID portion of the controller is <em>much</em> easier to tune “on top of” an accurate feedforward.</p>
<details class="summary-tuning-solution">
<summary>Tuning solution</summary><p>In this particular example, for a setpoint of 300, values of <span class="math notranslate nohighlight">\(K_v = 0.0075\)</span> and <span class="math notranslate nohighlight">\(K_p = 0.1\)</span>  will produce very good results across all setpoints.  Small changes to  <span class="math notranslate nohighlight">\(K_p\)</span> will change the controller behavior to be more or less aggressive - the optimal choice depends on your problem constraints.</p>
</details><p>Note that the combined feedforward-feedback controller works well across all setpoints, and recovers very quickly after the external disturbance of the ball contacting the flywheel.</p>
</section>
</section>
<section id="tuning-conclusions">
<h2>Tuning Conclusions<a class="headerlink" href="#tuning-conclusions" title="Permalink to this heading"></a></h2>
<section id="applicability-of-velocity-control">
<h3>Applicability of Velocity Control<a class="headerlink" href="#applicability-of-velocity-control" title="Permalink to this heading"></a></h3>
<p>A gamepiece-launching flywheel is one of the most visible applications of velocity control. It is also applicable to drivetrain control - following a pre-defined path in autonomous involves controlling the velocity of the wheels with precision, under a variety of different loads.</p>
</section>
<section id="choice-of-control-strategies">
<h3>Choice of Control Strategies<a class="headerlink" href="#choice-of-control-strategies" title="Permalink to this heading"></a></h3>
<p>Because we are controlling velocity, we can achieve fairly good performance with a <a class="reference internal" href="#pure-feedforward-control"><span class="std std-ref">pure feedforward controller</span></a>.  This is because a permanent-magnet DC motor’s steady-state velocity is roughly proportional to the voltage applied, and is the reason that you can drive your robot around with joysticks without appearing to use any control loop at all - in that case, you are implicitly using a proportional feedforward model.</p>
<p>Because we must apply a constant control voltage to the motor to maintain a velocity at the setpoint, we cannot successfully use a <a class="reference internal" href="#pure-feedback-control"><span class="std std-ref">pure feedback (PID) controller</span></a> (whose output typically disappears when you reach the setpoint) - in order to effectively control velocity, a feedback controller must be <a class="reference internal" href="#combined-feedforward-and-feedback-control"><span class="std std-ref">combined with a feedforward controller</span></a>.</p>
<p>Bang-bang control can be combined with feedforward control much in the way PID control can - for the sake of brevity we do not include a combined feedforward-bang-bang simulation.</p>
<p>Tuning with only feedback can produce reasonable results in cases where no <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-control-effort"><span class="xref std std-term">control effort</span></a> is required to keep the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-output"><span class="xref std std-term">output</span></a> at the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-setpoint"><span class="xref std std-term">setpoint</span></a>. This may work for mechanisms like turrets, or swerve drive steering. However, as seen above, it does not work well for a flywheel, where the back-EMF and friction both act to slow the motor even when it is sustaining motion at the setpoint. To control this system, we need to combine the PID controller with a feedforward controller.</p>
<p><span class="math notranslate nohighlight">\(K_d\)</span> is not useful for velocity control with a constant setpoint - it is only necessary when the setpoint is changing.</p>
<p>Adding an integral gain to the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-controller"><span class="xref std std-term">controller</span></a> is often a sub-optimal way to eliminate <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-steady-state-error"><span class="xref std std-term">steady-state error</span></a> - you can see how sloppy and “laggy” it is in the simulation above! As we will see soon, a better approach is to combine the PID controller with a feedforward controller.</p>
</section>
<section id="velocity-and-position-control">
<h3>Velocity and Position Control<a class="headerlink" href="#velocity-and-position-control" title="Permalink to this heading"></a></h3>
<p>Velocity control also differs from position control in the effect of inertia - in a position controller, inertia tends to cause the mechanism to swing past the setpoint even if the control voltage drops to zero near the setpoint.  This makes aggressive control strategies infeasible, as they end up wasting lots of energy fighting self-induced oscillations.  In a velocity controller, however, the effect is different - the rotor shaft stops accelerating as soon as you stop applying a control voltage (in fact, it will slow down due to friction and back-EMF), so such overshoots are rare (in fact, overshoot typically occurs in velocity controllers only as a result of loop delay).  This enables the use of an extremely simple, extremely aggressive control strategy called <a class="reference internal" href="#bang-bang-control"><span class="std std-ref">bang-bang control</span></a>.</p>
</section>
<section id="feedforward-simplifications">
<h3>Feedforward Simplifications<a class="headerlink" href="#feedforward-simplifications" title="Permalink to this heading"></a></h3>
<p>For the sake of simplicity, the simulations above omit the <span class="math notranslate nohighlight">\(K_s\)</span> term from the WPILib SimpleMotorFeedforward equation.  On actual mechanisms, however, this can be important - especially if there’s a lot of friction in the mechanism gearing.  A flywheel with a lot of static friction will not have a linear control voltage-velocity relationship unless the feedforward controller includes a <span class="math notranslate nohighlight">\(K_s\)</span> term to cancel it out.</p>
<p>To measure <span class="math notranslate nohighlight">\(K_s\)</span> manually, slowly increase the voltage to the mechanism until it starts to move.  The value of <span class="math notranslate nohighlight">\(K_s\)</span> is the largest voltage applied before the mechanism begins to move.</p>
<p>Additionally, there is no need for a <span class="math notranslate nohighlight">\(K_a\)</span> term in the feedforward for velocity control unless the setpoint is changing - for a flywheel, this is not a concern, and so the gain is omitted here.</p>
</section>
</section>
<section id="footnotes">
<h2>Footnotes<a class="headerlink" href="#footnotes" title="Permalink to this heading"></a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>For this simulation, we model a ball being injected to the flywheel as a velocity-dependant (frictional) torque fighting the spinning of the wheel for one quarter of a wheel rotation, right around the 5 second mark. This is a very simplistic way to model the ball, but is sufficient to illustrate the controller’s behavior under a sudden load. It would not be sufficient to predict the ball’s trajectory, or the actual “pulldown” in <a class="hxr-hoverxref hxr-tooltip reference internal" href="../controls-glossary.html#term-output"><span class="xref std std-term">output</span></a> for the system.</p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial-intro.html" class="btn btn-neutral float-left" title="Introduction To Controls Tuning Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tuning-turret.html" class="btn btn-neutral float-right" title="Tuning a Turret Position Controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, FIRST and other WPILib Contributors. This work is licensed under a Creative Commons Attribution 4.0 International License.
      <span class="commit">Revision <code>c3ff9f30</code>.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/2022/">2022</a></dd>
        
          <dd><a href="/en/2021/">2021</a></dd>
        
          <dd><a href="/en/2020/">2020</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//docs.wpilib.org/_/downloads/en/latest/pdf/">pdf</a></dd>
        
          <dd><a href="//docs.wpilib.org/_/downloads/en/latest/htmlzip/">html</a></dd>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/frc-docs/?fromdocs=frc-docs">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/frc-docs/?fromdocs=frc-docs">Builds</a>
          </dd>
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
  <script>
    if (typeof READTHEDOCS_DATA !== 'undefined') {
        if (!READTHEDOCS_DATA.features) {
          READTHEDOCS_DATA.features = {};
        }
        READTHEDOCS_DATA.features.docsearch_disabled = false;
      }
    </script>

</body>
</html>